# git-cliff configuration for AccessiWeather
# https://git-cliff.org/docs/configuration
# Format: Keep a Changelog (https://keepachangelog.com/en/1.0.0/)

[changelog]
# Header with Keep a Changelog reference
header = """
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

"""
# Body template - clean entries without PR links
body = """
{% if version -%}
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else -%}
    ## [Unreleased]
{% endif -%}
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | upper_first }}
    {% for commit in commits %}
        - {{ commit.message | split(pat="\n") | first | upper_first | trim }}
    {% endfor %}
{% endfor %}
"""
# Footer with version comparison links
footer = """
{% for release in releases -%}
    {% if release.version -%}
        {% if release.previous.version -%}
            [{{ release.version | trim_start_matches(pat="v") }}]: https://github.com/Orinks/AccessiWeather/compare/{{ release.previous.version }}...{{ release.version }}
        {% else -%}
            [{{ release.version | trim_start_matches(pat="v") }}]: https://github.com/Orinks/AccessiWeather/releases/tag/{{ release.version }}
        {% endif -%}
    {% else -%}
        [Unreleased]: https://github.com/Orinks/AccessiWeather/compare/{{ release.previous.version }}...HEAD
    {% endif -%}
{% endfor %}
"""
trim = true
postprocessors = []

[git]
# Parse conventional commits
conventional_commits = true
# Include non-conventional commits too
filter_unconventional = false
# Process commits normally
split_commits = false
# Clean up commit messages
commit_preprocessors = [
    # Remove issue/PR numbers from messages for cleaner display
    { pattern = '\((\w+\s)?#([0-9]+)\)', replace = "" },
    # Remove trailing periods
    { pattern = '\.+$', replace = "" },
]
# Map commits to Keep a Changelog groups
commit_parsers = [
    # Skip noise - merge commits
    { message = "^Merge", skip = true },
    { message = "^merge", skip = true },

    # Skip noise - conventional commit types users don't care about
    { message = "^chore\\(release\\)", skip = true },
    { message = "^chore\\(deps\\)", skip = true },
    { message = "^chore\\(pr\\)", skip = true },
    { message = "^chore\\(pull\\)", skip = true },
    { message = "^ci", skip = true },
    { message = "^build", skip = true },
    { message = "^chore", skip = true },
    { message = "^style", skip = true },
    { message = "^test", skip = true },

    # Skip noise - dev/CI keywords in any commit message
    { message = "(?i)git-cliff", skip = true },
    { message = "(?i)github.pages", skip = true },
    { message = "(?i)github.actions", skip = true },
    { message = "(?i)workflow", skip = true },
    { message = "(?i)pyinstaller", skip = true },
    { message = "(?i)ci/cd", skip = true },
    { message = "(?i)linting", skip = true },
    { message = "(?i)pre-commit", skip = true },
    { message = "(?i)dependabot", skip = true },
    { message = "(?i)codecov", skip = true },
    { message = "(?i)coverage", skip = true },
    { message = "(?i)[.]github", skip = true },
    { message = "(?i)release.notes", skip = true },
    { message = "(?i)changelog", skip = true },
    { message = "(?i)update-pages", skip = true },
    { message = "(?i)nightly", skip = true },
    { message = "(?i)build_tag", skip = true },
    { message = "(?i)app\\.version", skip = true },

    # Added - new features
    { message = "^feat", group = "Added" },
    { message = "^[a|A]dd", group = "Added" },
    { message = "^[s|S]upport", group = "Added" },
    { message = "^.*: add", group = "Added" },
    { message = "^.*: support", group = "Added" },

    # Fixed - bug fixes (user-facing only)
    { message = "^fix", group = "Fixed" },
    { message = "^.*: fix", group = "Fixed" },
    { message = "^hotfix", group = "Fixed" },

    # Removed
    { message = "^[r|R]emove", group = "Removed" },
    { message = "^.*: remove", group = "Removed" },
    { message = "^.*: delete", group = "Removed" },
    { message = "^deprecate", group = "Deprecated" },

    # Security
    { body = ".*security", group = "Security" },
    { message = "^security", group = "Security" },

    # Changed - only conventional commits that aren't caught above
    { message = "(?i)refactor.*build", skip = true },
    { message = "^refactor", group = "Changed" },
    { message = "^perf", group = "Changed" },

    # Skip everything else - if it's not conventional, it's probably dev noise
    { message = "^.*", skip = true },
]
# Protect breaking changes
protect_breaking_commits = true
# Filter out skipped commits
filter_commits = true
# Show oldest first within groups (chronological)
sort_commits = "oldest"
# Link parsers
link_parsers = [
    { pattern = "#(\\d+)", href = "https://github.com/Orinks/AccessiWeather/issues/$1" },
]

# GitHub integration
[remote.github]
owner = "Orinks"
repo = "AccessiWeather"
